name: ai-project
metadata:
  description: Agentic AI Platform with FastAPI Backend and React Frontend
  version: 0.1.0

# The services section defines the services in your application
services:
  api:
    project: .
    language: python
    docker:
      path: ./apps/api/Dockerfile
    host: containerapp
    deploy:
      bicep: ./infra/api.bicep
      # parameters: ./infra/api.parameters.json
    
  functions:
    project: .
    language: python
    docker:
      path: ./apps/functions/Dockerfile
    host: containerapp
    deploy:
      bicep: infra/functions.bicep
    
  ui:
    project: .
    language: js
    docker:
      path: ./apps/ui/Dockerfile
      context: .
    host: containerapp
    deploy:
      bicep: infra/ui.bicep
    # hooks:
    #   postdeploy:
    #     shell: pwsh
    #     run: ./scripts/ui-postdeploy.ps1

# Infrastructure as Code definition
infra:
  path: ./infra
  module: main

# Hooks for post-provision operations
hooks:
  # postprovision:
  #   shell: pwsh
  #   run: ./scripts/postprovision.ps1
  predeploy:
    shell: pwsh
    run: ./scripts/predeploy.ps1
  postdeploy:
    shell: pwsh
    run: ./scripts/postdeploy.ps1

# Environment variables to be set when the application is running
env:
  # These will be passed to the bicep deployment
  AZURE_SUBSCRIPTION_ID: ${AZURE_SUBSCRIPTION_ID}
  AZURE_LOCATION: ${AZURE_LOCATION}
  AZURE_RESOURCE_GROUP: ${AZURE_RESOURCE_GROUP}
  AZURE_CONTAINER_REGISTRY_NAME: ${AZURE_CONTAINER_REGISTRY_NAME}
  AZURE_CONTAINER_REGISTRY_ENDPOINT: ${AZURE_CONTAINER_REGISTRY_ENDPOINT}
  REGISTRY_LOGIN_SERVER: ${AZURE_CONTAINER_REGISTRY_ENDPOINT}
  INDEX_NUMBER: ${INDEX_NUMBER}
  BUILD_TAG: ${BUILD_TAG}